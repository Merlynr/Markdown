---
title: 2019-3-6危险的HTTP头参数
tags: http,hat
grammar_cjkRuby: true
---

## X-Forwarded-For
 1. [正向代理，反向代理，透明代理](https://blog.51cto.com/z00w00/1031287)
 
 <font color="#db494a">正向代理</font>，即代理服务器充当客户机向服务器发起请求，然后将返回数据报文返回到客户机。
 <font color='#d0c29f'>作用：</font>1. 避免因路由器发生故障无法保证请求服务，代理服务器可以绕过必要路由发起请求。2. 加速访问服务器，绕过多余的路由直接访问服务器。3. Cache作用，即代理服务器缓存请求过的数据报文，当客户机再次发起请求的时候，直接将以前报文返回给客户机，减少时间。 
 
 ![正向代理](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551886318563.png)
 
 4. 控制客户端访问权限，将防火墙作为局域网的网关，只有拥有权限的客户机才可以通过代理服务器访问外网。
 
 ![客户端访问授权](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551886960720.png)
 
 5. 隐藏客户机的行踪，肉鸡！

<font color="#db494a">反向代理</font>，即代理服务器充当服务器，客户机不会知晓自己是不是真的访问原始资源服务器。
<font color='#d0c29f'>作用：</font>1. Cache，即代理服务器缓存原始资源服务器，客户机可以直接向代理服务器获取资源，减少原始资源服务器请求压力，同时保证了客户机的访问速度【负载均衡】。

![负载均衡](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551887450038.png). 

2. 保护和隐藏原始资源服务器，客户机无法直接访问原始资源服务器。

![ 保护和隐藏原始资源服务器](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551887505079.png)

<font color="#db494a">透明代理</font>，理解为，公司，或个人对于局域网内的客户机进行的【行为管理软件】。翻墙【SSR】~~~

![透明代理](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551887673660.png)

<font color="#00ffff">[透明代理和正向代理的区别](http://www.cnblogs.com/f-ck-need-u/p/9739870.html)</font>
1. 正向代理时，客户端明确指明请求要交给正向代理服务，也就是说要设置代理。而透明代理对客户端是透明的，客户端不知道更不用设置透明代理，但是客户端发出去的请求都会被透明代理拦截。
2. 正向代理为了实现某些额外的需求，有可能会修改请求报文，但按照RFC文档的要求，透明代理不会修改请求报文。
3. 正向代理可以内网也可以外网，但透明代理都是内网。

![透明代理](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551888241784.png)

![正向代理](https://www.github.com/Merlynr/Markdown/raw/noteImg/小书匠/1551888259081.png)

结论：X-Forwarded-For会将数据包通过的路由的ip保存在头部，即可以从头部获取到请求端的ip，但是由于代理的泛滥，不可信，但是在一些企业中用于对局域网内客户机进行管理有很大作用。
1. 直接对外提供服务的 Web 应用，在进行与安全有关的操作时，只能通过 Remote Address 获取 IP，不能相信任何请求头；
2. 使用 Nginx 等 Web Server 进行反向代理的 Web 应用，在配置正确的前提下，要用 X-Forwarded-For 最后一节 或 X-Real-IP 来获取 IP（因为 Remote Address 得到的是 Nginx 所在服务器的内网 IP）；同时还应该禁止 Web 应用直接对外提供服务；
3. 在与安全无关的场景，例如通过 IP 显示所在地天气，可以从 X-Forwarded-For 靠前的位置获取 IP，但是需要校验 IP 格式合法性


## Referer 访问源
即在访问网页服务器的时候，header部分上的Referer会携带访问源。

 <font color='#d0c29f'>作用：</font>1. 利用Referer防止图片盗链，利用监控Referer来访问请求是否合理！【CSRF】2. 防止恶意请求。